from django.shortcuts import render
import pyautogui, sys
from time import sleep
import time
import ctypes
import mouseinfo
from django.http import HttpResponseRedirect
from mazeApp.get_pixel_info import *
from django.urls import reverse
from mazeApp.forms import UserRegistrationForm
# Create your views here.
def BasePage(request):

    return render(request, 'mazeApp/BasePage.html',)

def HomePage(request):


    cond = True

    pos_li = [(495, 229), (495, 229), (495, 229), (495, 229), (495, 229), (495, 229), (495, 229), (495, 229), (495, 229), (495, 229),
 (495, 229), (495, 229), (494, 229), (491, 232), (489, 233), (489, 233), (489, 233), (489, 233), (489, 233), (489, 233),
 (489, 233), (489, 233), (489, 233), (489, 233), (489, 233), (488, 235), (487, 236), (485, 238), (483, 240), (479, 245),
 (476, 247), (476, 248), (473, 249), (472, 250), (472, 250), (471, 251), (471, 251), (471, 251), (471, 251), (471, 251),
 (471, 251), (470, 251), (464, 251), (459, 255), (452, 258), (450, 260), (446, 261), (446, 261), (446, 261), (445, 261),
 (443, 262), (437, 265), (436, 265), (431, 265), (429, 266), (427, 266), (423, 269), (420, 270), (419, 270), (419, 270),
 (417, 270), (416, 270), (413, 270), (407, 272), (401, 272), (397, 272), (395, 272), (395, 272), (395, 272), (395, 272),
 (392, 273), (385, 274), (381, 274), (378, 275), (375, 277), (373, 278), (371, 279), (371, 280), (370, 281), (368, 282),
 (368, 282), (368, 282), (368, 283), (368, 285), (367, 290), (367, 294), (366, 298), (366, 303), (364, 308), (364, 314),
 (364, 317), (364, 319), (364, 321), (364, 321), (364, 323), (364, 324), (364, 324), (364, 324), (364, 324), (364, 324),
 (364, 324), (365, 327), (368, 331), (373, 334), (376, 336), (379, 338), (381, 340), (384, 341), (385, 342), (385, 342),
 (385, 342), (385, 342), (385, 342), (388, 343), (394, 345), (398, 346), (405, 347), (411, 347), (419, 347), (424, 348),
 (429, 348), (440, 348), (443, 348), (451, 348), (457, 348), (466, 348), (472, 348), (478, 348), (483, 348), (489, 348),
 (493, 348), (498, 348), (506, 348), (512, 348), (518, 348), (524, 348), (533, 348), (541, 348), (547, 350), (554, 350),
 (560, 350), (564, 350), (570, 350), (575, 351), (578, 352), (580, 352), (581, 352), (581, 352), (581, 352), (583, 353),
 (583, 353), (583, 354), (583, 354), (583, 354), (583, 354), (583, 355), (583, 355), (583, 355), (583, 356), (583, 357),
 (584, 358), (584, 358), (584, 358), (584, 359), (587, 362), (589, 367), (592, 377), (594, 386), (597, 395), (599, 405),
 (599, 412), (599, 417), (599, 420), (599, 421), (599, 422), (599, 423), (599, 424), (599, 425), (599, 427), (599, 429),
 (599, 433), (599, 436), (599, 439), (598, 441), (597, 447), (597, 451), (597, 456), (596, 458), (595, 462), (595, 465),
 (594, 469), (593, 472), (592, 474), (589, 479), (588, 482), (586, 485), (583, 488), (581, 490), (581, 490), (581, 490),
 (580, 491), (579, 493), (576, 495), (573, 499), (570, 501), (568, 504), (567, 504), (566, 506), (561, 508), (558, 511),
 (553, 512), (549, 515), (544, 517), (543, 517), (539, 517), (537, 517), (536, 517), (535, 517), (532, 517), (529, 519),
 (528, 519), (525, 521), (522, 523), (520, 525), (518, 527), (515, 529), (515, 530), (515, 530), (514, 533), (512, 537),
 (511, 543), (510, 551), (510, 554), (510, 556), (510, 558), (510, 558), (510, 559), (508, 563), (505, 566), (501, 571),
 (493, 578), (488, 583), (484, 586), (479, 587), (475, 590), (470, 592), (467, 593), (463, 595), (459, 597), (458, 597),
 (458, 597), (458, 597), (457, 598), (457, 599), (454, 602), (452, 607), (448, 615), (446, 620), (445, 628), (443, 636),
 (441, 641), (439, 648), (438, 653), (436, 660), (435, 662), (435, 662), (435, 665), (435, 671), (435, 675), (437, 683),
 (440, 688), (441, 692), (445, 702), (447, 706), (451, 714), (455, 722), (456, 725), (457, 727), (457, 729), (457, 731),
 (460, 733), (460, 734), (463, 735), (468, 737), (476, 738), (483, 738), (490, 738), (495, 738), (497, 738), (501, 739),
 (505, 740), (509, 742), (509, 743), (511, 744), (511, 745), (512, 749), (514, 751), (516, 758), (516, 762), (516, 767),
 (516, 771), (516, 773), (516, 775), (516, 776), (518, 779), (523, 780), (524, 780), (524, 780), (524, 780), (524, 780),
 (524, 780), (524, 780), (524, 780), (524, 780), (524, 780), (524, 780), (524, 780), (524, 780), (524, 780), (524, 780),
 (524, 780), (524, 780), (524, 780), (524, 780), (524, 781), (524, 783), (524, 784), (523, 787), (523, 790), (522, 792),
 (522, 799), (518, 811), (513, 824), (511, 835), (509, 842), (509, 842), (509, 842), (509, 842), (509, 844), (509, 851),
 (509, 855), (509, 862), (509, 865), (509, 872), (509, 875), (509, 878), (509, 880), (509, 882), (509, 887), (509, 890),
 (509, 894), (509, 898), (509, 901), (509, 902), (509, 903), (509, 907), (509, 911), (509, 917), (509, 921), (509, 926),
 (508, 930), (508, 932), (508, 937), (508, 940), (508, 944), (508, 948), (508, 952), (508, 954), (508, 956), (508, 958),
 (508, 958), (508, 958), (508, 959), (508, 960), (508, 963), (508, 965), (508, 967), (508, 971), (508, 974), (508, 978),
 (508, 979), (508, 981), (508, 982), (508, 982), (508, 982), (508, 982), (508, 982), (508, 982), (508, 982), (508, 982),
 (508, 982), (508, 982), (508, 982), (508, 982), (508, 982), (508, 982), (508, 982), (508, 982), (508, 982), (508, 982),
 (508, 982), (508, 982), (508, 983), (508, 985), (508, 985), (508, 985), (508, 985), (508, 985), (508, 985), (508, 986),
 (508, 986), (508, 987), (508, 987), (508, 988), (508, 989), (508, 989), (508, 990), (508, 990), (508, 992), (508, 992),
 (508, 992), (508, 992), (508, 992), (508, 992), (507, 995), (507, 995), (507, 995), (507, 995), (507, 996), (506, 998),
 (505, 1001), (504, 1002), (504, 1002), (503, 1005), (503, 1005), (503, 1005), (503, 1005), (503, 1005), (503, 1005),
 (503, 1005), (503, 1005), (503, 1005), (502, 1005), (502, 1005), (499, 1007), (499, 1008), (496, 1010), (493, 1011),
 (492, 1011), (488, 1012), (488, 1012), (486, 1013), (486, 1013), (486, 1013), (485, 1013), (485, 1013), (485, 1013),
 (483, 1013), (477, 1013), (474, 1013), (473, 1013), (472, 1013), (472, 1013), (472, 1013), (472, 1013), (471, 1013), (470, 1013),
 (469, 1013), (469, 1013), (469, 1013), (468, 1012), (468, 1011), (467, 1010), (467, 1010), (466, 1009), (466, 1008),
 (465, 1006), (465, 1006), (465, 1005), (465, 1005), (464, 1003), (464, 1002), (463, 1000), (463, 1000), (463, 1000), (463, 1000), (463, 999)]

    t_start = time.time()

    # while cond:



        ## RECEIVING CURRENT CURSOR POSITION ON THE INTERFACE
        # (x,y) = pyautogui.position()
        # pos_li.append((x,y))
    for item in pos_li:
        pyautogui.moveTo(item[0],item[1])

        ## FINDING THE RGB REFERENCES USING THE X AND Y LOCATIONS OF THE CURSOR
        colorRef = ctypes.windll.gdi32.GetPixel(dc, item[0], item[1])  # A COLORREF value as 0x00bbggrr. See https://docs.microsoft.com/en-us/windows/win32/gdi/colorref
        red = colorRef % 256
        colorRef //= 256
        green = colorRef % 256
        colorRef //= 256
        blue = colorRef

        li = [red,green,blue]

        ## PRINTING OUT THE COORDINATES AND RGB BAND
        print('X: COORDINATE: ' + str(item[0]) + '   Y COORDINATE ' +  str(item[0]) + ' ')

        print('RGB' + str(li))

        # pyautogui.moveTo(1920 - (x+w), 1080 - (y+h))

        ## LOOP BREAK CONDITION ///// WHEN USER TOUCHED THE BOUNDARY
        if li == [0,0,0]:
            cond = False
            message = "You touched the boundary! try again!!"
            break


    t_stop = time.time()
    counter = t_stop - t_start

    print(counter)
    print(pos_li)


    return render(request,'mazeApp/HomePage.html', {'time':str(counter)[:5],'message':message})
    # return HttpResponseRedirect(reverse('basepage'),{'message':message})

def UserRegistrationPage(request):


    form = UserRegistrationForm()

    if request.method == 'POST':

        form = UserRegistrationForm(data = request.POST)

        if form.is_valid():

            user = form.save()

            user.set_password(user.password)

            user.save()

            return BasePage(request)

    return render(request,'mazeApp/UserRegistrationPage.html',{'form':form})
